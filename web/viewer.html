<doctype HTML>
	<html>
	<head>
		<script src="js/autobahn.min.js"></script>
		<script type="text/javascript" src="js/pdfjs/pdf.js"></script>
		<script type="text/javascript" src="js/paper.js"></script>

	</head>
	<!-- <object data="The-Bebop-Bible.pdf#navpanes=0&scrollbar=0&toolbar=0&zoom=100" width="100%" height="100%" alt="pdf" pluginspage="http://www.adobe.com/products/acrobat/readstep2.html"/> -->

	<button id="prev">Previous</button>
	<button id="next">Next</button>
	<span>Page: <span id="page_num"></span> / <span id="page_count"></span></span>

	<canvas id="the-canvas"></canvas>
	<script type="text/javascript" src="js/player.js" > </script>


	<script type="text/paperscript" canvas="the-canvas">

	var project = paper.project.activate();

	function drawAnnotations(ann) {
		console.log("drawing new annotation");
		console.log(ann);
		project.activeLayer.importJSON(ann);

	}


	</script>



	<script>

	function firstLoad(song) {
		console.log("loading initial song", song);
		try {getPDFfromURL(song);}
		catch(err) {
			console.log("can't load song because", err);
			changeSong(song);}
	}

	var wsuri = "ws://" + window.location.hostname + ":7777/ws";
	var connection = new autobahn.Connection({
		url: wsuri,
		realm: "realm1"
	});
	connection.onopen = function (session, details) {
		console.log("Connected: ", details);



		session.subscribe('local.conductor.songURL', getPDFfromURL);

		session.subscribe('local.conductor.song', changeSong);

		session.subscribe('local.conductor.page', queueRenderPage);
		session.subscribe('local.conductor.annotations', drawAnnotations);

		session.call('local.conductor.getSong').then(function(res) {firstLoad(res);});
	};


	connection.open();
	document.getElementById('next').addEventListener('click', onNextPage, false);
	document.getElementById('prev').addEventListener('click', onPrevPage, false);

</script>

</html></doctype>
