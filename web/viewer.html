<!-- <doctype HTML> -->
<html>
<head>
	<script src="js/autobahn.min.js"></script>
	<script type="text/javascript" src="js/pdfjs/pdf.js"></script>
	<script type="text/javascript" src="js/paper-full.js"></script>
	<script type="text/javascript" src="js/hammer.js"></script>
</head>
<!-- <object data="The-Bebop-Bible.pdf#navpanes=0&scrollbar=0&toolbar=0&zoom=100" width="100%" height="100%" alt="pdf" pluginspage="http://www.adobe.com/products/acrobat/readstep2.html"/> -->
<body>
	<!-- <button id="prev">Previous</button>
	<button id="next">Next</button> -->
	<span>Page: <span id="page_num"></span> / <span id="page_count"></span></span>

	<canvas id="pdfCanvas" style="z-index:0"></canvas>
	<!-- <canvas id="annCanvas" style="z-index:1"></canvas> -->
	<canvas id="navCanvas" style="z-index:1"></canvas>

</body>
<script type="text/javascript" src="js/player.js" > </script>
<link rel="stylesheet" type="text/css" href="js/player.css">
<link rel="stylesheet" type="text/css" href="js/animate.css">



<script type="text/paperscript" canvas="navCanvas" src="js/nav.js"></script>

<!-- <script type="text/paperscript", canvas="annCanvas"> -->


</script>


<script>

function firstLoad(song) {
	console.log("loading initial song", song);
	try {getPDFfromURL(song);}
	catch(err) {
		console.log("can't load song because", err);
		changeSong(song);}
	}

	var wsuri = "wss://" + window.location.hostname + "/ws";
	var connection = new autobahn.Connection({
		url: wsuri,
		realm: "realm1"
	});
	connection.onopen = function (session, details) {
		console.log("Connected: ", details);



		session.subscribe('local.conductor.songURL', getPDFfromURL);

		session.subscribe('local.conductor.song', changeSong);

		session.subscribe('local.conductor.page', queueRenderPage);
		session.subscribe('local.conductor.annotations', drawAnnotations);

//		session.call('local.conductor.getSong').then(function(res) {firstLoad(res);});
		session.call('local.conductor.getSong').then(function(res) {getPDFfromURL(res);});
	};


	connection.open();
	// document.getElementById('next').addEventListener('click', onNextPage, false);
	// document.getElementById('prev').addEventListener('click', onPrevPage, false);

</script>

</html>
<!-- </doctype> -->
